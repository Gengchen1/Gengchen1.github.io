---
title: C语言编译过程再理解
date: 2025-03-31
summary: 重新巩固一下以前的知识
category: Linux
tags:
  - Linux
comments: true
---

1. 预处理
   > 宏替换、头文件展开、去注释、条件编译
   ```c
   gcc -E test.c -o test.i
   ```
   `-o`:指明形成的临时文件名，预处理期间会把头文件拷贝到原文件中。
   程序在生成的时候必须要链接到库。目前还是C语言。
2. 编译
   > 语法和语义分析，将C语言编译成汇编语言，输出`.s`文件。
   ```bash
   gcc -S test.i -o test.s
   ```
3. 汇编 > 将汇编代码转换为机器码（二进制目标文件），生成目标文件，包含机器码和符号文件。
   ```bash
   gcc -c test.s -o test.o
   ```
   > 查看二进制文件，使用命令`od test.o`
4. 链接
   > 合并多个目标文件和库(c标准库)，生成可执行文件。
   >
   > 1. 将函数调用和变量引用关联到实际地址。
   > 2. 库文件整合：链接静态库`.a`和动态库`.so`。
   > 3. 重定位: 调整代码和数据的内存地址。
   ```bash
   gcc test.o -o test
   ```

## 调试和优化

- 调试信息可以加上`-g`选项，生成调式符号，用于`gdb`调试。
- 优化级别：`-O0`无优化、`-O2`（推荐优化）等调整性能。

## Q&A

1. 解释一下动态链接和静态链接。- 链接的本质：就是我们调用库函数时，是如何和标准库如何关联的问题？1. 动态链接：
   链接器告诉需要链接的库，每次用到的时候都动态链接外部库（比如C标准库）。
   动态链接可以使得形成的可执行程序体积小。2. 静态链接：
   链接器告诉需要的链接的库，然后将其拷贝一份到源码中去。>动态链接就是比如程序执行你在学校做的一系列事，其中包含上网，但是学校没有电脑，需要到学校外面的网吧来执行上网命令。这个网吧就是动态库。>而静态链接就是在学校里面自己宿舍安装了一台电脑，执行上网动作时不需要链接外部库。
   动态链接的优点：
1. 解释内存，磁盘，网络。
1. 大大降低程序大小。
   _linux中默认生成的可执行文件为动态链接。_
